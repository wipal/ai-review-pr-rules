metadata:
  id: "java-selenium-testng-maven-course"
  name: "Selenium + TestNG + Maven Complete Course"
  language: "java"
  frameworks: ["selenium", "testng", "maven"]
  difficulty: "beginner-to-intermediate"

# ============ REVIEW TEMPLATES ============
review_templates:
  summary_header: |
    # Code Review by Wipal
    **Config:** `{config_id}`
    **PR:** [{pr_title}]({pr_url})

  sections:
    critical:
      title: "## Critical Issues (Required)"
      description: "These issues MUST be fixed before approval."
      empty_message: "**No critical issues!**"

    optimization:
      title: "## Optimization & Refactoring (Recommended)"
      description: "Suggested improvements for better code quality."
      empty_message: "**No optimization suggestions.**"

    style:
      title: "## Style & Nitpicks (Nice to have)"
      description: "Minor style suggestions."
      empty_message: "**No style issues.**"

  conclusion:
    approved: |
      ## Approved
      Great job! Your submission meets all requirements.

      {checklist_summary}

    changes_requested: |
      ## Changes Requested
      Please fix the **critical issues** above and update this PR.

      {checklist_summary}

  checklist_summary: |
    ### Checklist Results
    {checklist_items}

    **Passed:** {passed_count}/{total_count}

  line_comment: "**{icon}** {message}\n\nTip: {suggestion}"

# ============ APPROVAL CRITERIA ============
approval_criteria:
  allow_errors: false
  max_warnings: 999
  require_all_checklist: false

# ============ AI SYSTEM ROLE TEMPLATE ============
ai_system_role_template: |
  You are an expert code reviewer for {language} projects using {frameworks}.

  Course: {course_name}
  Exercise: {exercise_name}

  Review focus:
  1. Critical errors that break functionality
  2. Code smell and anti-patterns
  3. Best practices for Selenium WebDriver, TestNG, and Maven

  IMPORTANT: Always include a "suggestion" field with specific guidance on how to fix each issue.

  Respond with JSON:
  {
    "scores": {"selenium": 0-50, "testng": 0-30, "maven": 0-20},
    "issues": [
      {"file": "...", "line": 42, "severity": "error|warning|info", "message": "...", "suggestion": "..."}
    ],
    "approval": true/false,
    "summary": "..."
  }

# PR Quality Rules - Apply to ALL submissions
pr_quality_rules:
  title:
    min_length: 10
    max_length: 80
    pattern: "^(ex|EX|Ex|exercise|Exercise)?\\s*\\d+\\.\\d+[:\\s-]+\\w+"
    pattern_description: "Title should follow format: 'ex1.1: Brief description' or 'Exercise 1.1 - Brief description'"
    must_not_contain: ["wip", "fix", "bug", "temp", "test", "update", "changes"]
    examples:
      good:
        - "ex1.1: Setup Maven project with Selenium and TestNG"
        - "Exercise 1.2 - ElementLocators class with 10 locators"
        - "ex1.3: Login automation using Selenium WebDriver"
      bad:
        - "wip"
        - "fix stuff"
        - "test"
        - "update code"
        - "changes"

  description:
    required_sections:
      - name: "summary"
        required: true
        description: "Brief summary of changes (1-2 sentences)"
      - name: "checklist"
        required: true
        description: "Checklist of completed items"
      - name: "screenshots"
        required: false
        description: "Screenshots or video demo"

    checklist_format: |
      ## What's done
      - [x] Item 1
      - [x] Item 2
      - [ ] Item 3 (if applicable)

    must_contain_keywords: ["test", "maven", "selenium"]

  images:
    required: false
    preferred_formats: ["png", "jpg", "jpeg", "gif", "mp4"]
    min_count_for_exercises: [3, 4]  # Exercise 1.3+ require screenshots
    message_if_missing: "Please add screenshots or screen recording showing your test execution"

# Shared quick rules for ALL exercises
quick_rules:
  # Selenium rules
  - id: "no_thread_sleep"
    pattern: "Thread\\.sleep\\([^)]*\\)"
    message: "Use WebDriverWait instead of Thread.sleep()"
    suggestion: "Replace with: new WebDriverWait(driver, Duration.ofSeconds(10)).until(ExpectedConditions...)"
    severity: "error"
    category: "selenium"

  - id: "no_println"
    pattern: "System\\.out\\.println"
    message: "Remove debug print statements"
    suggestion: "Use proper logging framework (SLF4J + Logback) or remove this line"
    severity: "warning"
    category: "code_quality"

  - id: "prefer_id_locator"
    pattern: "By\\.(xpath|cssSelector)\\("
    message: "Prefer ID locators over XPath/CSS when possible"
    suggestion: "Try using By.id() or By.name() for more stable locators"
    severity: "info"
    category: "selenium"

  # TestNG rules
  - id: "test_description"
    pattern: "@Test\\s*(?!.*description\\s*=)"
    message: "@Test should have description attribute"
    suggestion: "Add description: @Test(description = \"Verify login functionality\")"
    severity: "info"
    category: "testng"

  - id: "no_hard_assert"
    pattern: "Assert\\.(assertEquals|assertTrue)\\("
    message: "Prefer SoftAssert over hard asserts for multiple validations"
    suggestion: "Use SoftAssert to continue test after assertion failures"
    severity: "info"
    category: "testng"

  # Maven rules
  - id: "dependency_version"
    pattern: "<dependency>\\s*<groupId>[^<]+</groupId>\\s*<artifactId>[^<]+</artifactId>\\s*<version>"
    message: "Versions should be in <dependencyManagement> section"
    suggestion: "Move version to <dependencyManagement> section for better version management"
    severity: "warning"
    category: "maven"

# Shared AI instructions template
ai_instructions_template: |
  You are reviewing a Java exercise submission.

  ## Selenium Best Practices
  - Use Page Object Model pattern
  - Use WebDriverWait with ExpectedConditions
  - Prefer ID locators, avoid fragile XPath
  - Proper cleanup in @AfterMethod

  ## TestNG Usage
  - @Test with meaningful description
  - Tests isolated, no dependencies
  - Use DataProvider for parameterized tests
  - Proper assertion messages

  ## Maven Configuration
  - Versions in dependencyManagement
  - Correct scope usage (test/compile)
  - Standard directory layout

  Exercise-specific requirements: {exercise_requirements}

  Respond with JSON:
  {
    "scores": {"selenium": 0-50, "testng": 0-30, "maven": 0-20},
    "issues": [{"file": "...", "line": 42, "severity": "error|warning|info", "message": "...", "suggestion": "..."}],
    "approval": true/false,
    "summary": "overall assessment"
  }

# Default AI provider
ai_provider:
  primary: "zai"
  fallback: "ollama"
  model: "glm-4.7"

# Default checklist
checklist:
  - item: "No Thread.sleep() used"
    category: "selenium"
    weight: 15
  - item: "Explicit waits used"
    category: "selenium"
    weight: 15
  - item: "Proper locators used"
    category: "selenium"
    weight: 10
  - item: "@Test has description"
    category: "testng"
    weight: 10
  - item: "Tests are isolated"
    category: "testng"
    weight: 15
  - item: "Proper cleanup"
    category: "testng"
    weight: 10
  - item: "Maven dependencies correct"
    category: "maven"
    weight: 15
  - item: "Code follows conventions"
    category: "quality"
    weight: 10
